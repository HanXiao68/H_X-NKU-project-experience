### VIO知识回顾
* IMU预积分，传感器模型----
* iMU每个时刻都有一个噪声。协方差的传递

#### 视觉几何基础
* 特征点提取（fast角点），匹配（用光流，特征描述子）
* 已知俩图像特征匹配点：利用对极几何约束，算出本征矩阵E矩阵，H矩阵。。来计算俩图像之间 的pose。通过两个图像的特征点，可以算出两图像之间的R t。
* 已知了相机的pose，和特征点二维坐标。通过三角化可以得到路标点的三维坐标。
* 已知路标的三维坐标，和 在另一个图像中的2d特征点。可以用pnp算法，算出新的相机pose。

### 视觉可以形成一个相机的轨迹。自己内部形成一个尺度；IMU利用加速度计和陀螺仪，也可以得到一套轨迹；
怎么利用IMU轨迹和相机的轨迹融合。

1.算第一个b坐标系相对于世界坐标系的旋转矩阵，qwb；算第一个帧的加速度投到世界坐标系的加速度。
2.body坐标系到camera坐标系的

### 需要估计的量
1.body和相机的外参
2.body的坐标系投到世界坐标系。
### VINS鲁棒初始化
* 使用相机坐标系第一帧作为世界坐标系
* 第k帧的iMU投到世界坐标系，即第1帧的相机坐标系
* IMU和相机的外参可以量出来。
### 视觉iMU 对齐流程
估计过程：
    1.旋转外参数qbc未知。先估计旋转外参数。旋转很重要，平移不重要。
    为什么不重要：（论文中说的）
1.他们通过仿真结果证明了，如果运动不够剧烈（smooth motion），加速度计的bias是很难被观测出来的2.其次忽略加速度计的bias对估计其他初始值的影响并不大。3.加速度计的bias是可以通过之后的VIO紧耦合优化，慢慢被估计出来。4.在VI-ORB中，加速度计bias的收敛需要好几秒，而且没有一个很好的判定条件来判断加速度计bias的估计是否正确。
    2.利用旋转约束，估计陀螺仪bias。
    3.利用平移约束，可以估计重力方向，速度，以及尺度初始值。
    4.对重力向量 g c0 进行进一步优化
    5.求解世界坐标系w和初始相机坐标系C0之间的旋转矩阵qwc。将轨迹对齐到世界坐标系。
    6.代码中的calibrationExRotation（） 函数进行求解。
    7.假设通过旋转约束可以推算出外参数。
    公式10 ，将两个轨迹的目标函数最小化，利用旋转约束，估计陀螺仪的bias。               得出了相机坐标系和IMU坐标系之间的旋转。                                    
    
    8.相机和imu标定，可以使用kalibr  或者尺子测量。
    噪声项，通过协方差的传递，能够求出来。
    代码对应LinearAlignment()
    
    
 下：
    1.重力向量
    2.相机坐标系对齐到世界坐标系
    3.整个过程 估计了外参，重力，bias等参数。就完成了初始化。有了初始化，后来来新的状态量的时候，把新的协方差特征点，新的iMU值进行积分，重投影。就可以得出后面相机的轨迹相对于前面的。
    4.加速度bias为何没有估计？ 相对于重力来说量纲很小，可以忽略。
    5.相机，IMU平移外参数Pbc为何没有初始化？意义不大。
    6.其他初始化方法：静止初始化：直接用加速度测量重力方向，初始速度为0.
### VINS系统
    视觉sfm算法或者VO 可以算出相机的轨迹，和iMU的轨迹进行对齐。
    
    后端滑动窗口优化： 需要估计的变量：P V Q     Ba   Bg
    通过最小化滑动窗口中的残差项来估计系统的状态变量。其中，视觉残差中的鲁棒核函数 仅仅是处理视觉野值outlier。
